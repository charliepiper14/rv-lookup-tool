let formData = {};let area = 0;document.getElementById("step1").addEventListener("submit",async function(e){e.preventDefault();formData.name=this.name.value;formData.company=this.company.value;formData.email=this.email.value;formData.phone=this.phone.value;formData.postcode=this.postcode.value;const res=await fetch('/api/lookup-addresses?postcode='+formData.postcode);const addresses=await res.json();const select=document.getElementById("property-select");select.innerHTML="";addresses.forEach(addr=>{const opt=document.createElement("option");opt.value=addr.id;opt.textContent=addr.address;select.appendChild(opt);});this.style.display="none";document.getElementById("step2").style.display="block";initMap();});function initMap(){const map=new google.maps.Map(document.getElementById("map"),{zoom:18,center:{lat:51.5045,lng:-0.0865},mapTypeId:"satellite"});const draw=new google.maps.drawing.DrawingManager({drawingControl:true,drawingControlOptions:{drawingModes:["polygon"]},polygonOptions:{fillColor:"#ffff00",fillOpacity:0.5,strokeWeight:2,editable:true}});draw.setMap(map);google.maps.event.addListener(draw,"polygoncomplete",function(poly){area=google.maps.geometry.spherical.computeArea(poly.getPath());alert("Area: "+area.toFixed(2)+" mÂ²");});}document.getElementById("step2").addEventListener("submit",async function(e){e.preventDefault();const id=document.getElementById("property-select").value;const res=await fetch("/api/fetch-valuation?id="+id);const data=await res.json();formData.address=data.address;formData.description=data.description;formData.rv=data.rateable_value;formData.area=area||document.getElementById("manual-area").value;formData.source="RV_Lookup";document.getElementById("rv-address").textContent=data.address;document.getElementById("rv-description").textContent=data.description;document.getElementById("rv-value").textContent=data.rateable_value;document.getElementById("rv-area").textContent=formData.area;document.getElementById("step2").style.display="none";document.getElementById("step3").style.display="block";});function submitData(){fetch("https://hooks.zapier.com/hooks/catch/14702841/20cxqnc/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formData)}).then(()=>alert("Submitted!"));}